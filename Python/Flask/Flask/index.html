<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.1.7"><title>Flask - Notes</title><link rel=stylesheet href=../../../assets/stylesheets/main.4c7052ca.min.css><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style></head> <body dir=ltr> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#flask class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=../../.. title=Notes class="md-header-nav__button md-logo" aria-label=Notes> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Notes </span> <span class="md-header-nav__topic md-ellipsis"> Flask </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class="md-tabs__link md-tabs__link--active"> Home </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=Notes class="md-nav__button md-logo" aria-label=Notes> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> Notes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=Home class=md-nav__link> Home </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 依赖 </a> <nav class=md-nav aria-label=依赖> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 可选依赖 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#flask_1 class=md-nav__link> 最小的 Flask 应用 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 运行应用 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 调试模式 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 路由 </a> <nav class=md-nav aria-label=路由> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 变量规则 </a> </li> <li class=md-nav__item> <a href=#url class=md-nav__link> 唯一的 URL / 重定向行为 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=flask>Flask<a class=headerlink href=#flask title="Permanent link">&para;</a></h1> <p>参考资料：</p> <p><a href=https://dormousehole.readthedocs.io/en/latest/installation.html#installation>安装</a></p> <p><a href=https://dormousehole.readthedocs.io/en/latest/quickstart.html>快速上手</a></p> <p><a href=https://dormousehole.readthedocs.io/en/latest/tutorial/index.html#tutorial>教程</a></p> <p><a href=https://dormousehole.readthedocs.io/en/latest/patterns/index.html#patterns>Flask 方案</a></p> <p><a href=https://dormousehole.readthedocs.io/en/latest/ >文档</a></p> <p><a href=https://dormousehole.readthedocs.io/en/latest/api.html#api>API</a></p> <hr> <div class=highlight><pre><span></span><code>pip install Flask <span class=c1># 安装 Flask，建议安装在 venv 中</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>flask</span>
</code></pre></div> <p>不要使用 <code>flask.py</code> 作为应用名称，这会与 Flask 本身发生冲突。</p> <h2 id=_1>依赖<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <p>当安装 Flask 时，以下配套软件会被自动安装。</p> <ul> <li><a href=https://palletsprojects.com/p/werkzeug/ >Werkzeug</a> 用于实现 WSGI ，应用和服务之间的标准 Python 接口。</li> <li><a href=https://palletsprojects.com/p/jinja/ >Jinja</a> 用于渲染页面的模板语言。</li> <li><a href=https://palletsprojects.com/p/markupsafe/ >MarkupSafe</a> 与 Jinja 共用，在渲染页面时用于避免不可信的输入，防止注入攻击。</li> <li><a href=https://palletsprojects.com/p/itsdangerous/ >ItsDangerous</a> 保证数据完整性的安全标志数据，用于保护 Flask 的 session cookie.</li> <li><a href=https://palletsprojects.com/p/click/ >Click</a> 是一个命令行应用的框架。用于提供 <code>flask</code> 命令，并允许添加自定义 管理命令。</li> </ul> <h3 id=_2>可选依赖<a class=headerlink href=#_2 title="Permanent link">&para;</a></h3> <p>以下配套软件不会被自动安装。如果安装了，那么 Flask 会检测到这些软件。</p> <ul> <li><a href=https://pythonhosted.org/blinker/ >Blinker</a> 为 <a href=https://dormousehole.readthedocs.io/en/latest/signals.html#signals>信号</a> 提供支持。</li> <li><a href=https://simplejson.readthedocs.io/ >SimpleJSON</a> 是一个快速的 JSON 实现，兼容 Python’s <code>json</code> 模块。如果安装 了这个软件，那么会优先使用这个软件来进行 JSON 操作。</li> <li><a href=https://github.com/theskumar/python-dotenv#readme>python-dotenv</a> 当运行 <code>flask</code> 命令时为 <a href=https://dormousehole.readthedocs.io/en/latest/cli.html#dotenv>通过 dotenv 设置环境变量</a> 提供支持。</li> <li><a href=https://pythonhosted.org/watchdog/ >Watchdog</a> 为开发服务器提供快速高效的重载。</li> </ul> <h2 id=flask_1>最小的 Flask 应用<a class=headerlink href=#flask_1 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=c1># hello.py</span>
<span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span>
<span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>

<span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>hello_world</span><span class=p>():</span>
    <span class=k>return</span> <span class=s1>&#39;Hello, World!&#39;</span>
</code></pre></div> <ol> <li>首先我们导入了 <a href=https://dormousehole.readthedocs.io/en/latest/api.html#flask.Flask><code>Flask</code></a> 类。 该类的实例将会成为我们的 WSGI 应用。</li> <li>接着我们创建一个该类的实例。第一个参数是应用模块或者包的名称。如果你使用 一个单一模块（就像本例），那么应当使用 <code>__name__</code> ，因为名称会根据这个 模块是按应用方式使用还是作为一个模块导入而发生变化（可能是 ‘<strong>main</strong>’ ， 也可能是实际导入的名称）。这个参数是必需的，这样 Flask 才能知道在哪里可以 找到模板和静态文件等东西。更多内容详见 <a href=https://dormousehole.readthedocs.io/en/latest/api.html#flask.Flask><code>Flask</code></a> 文档。</li> <li>然后我们使用 <a href=https://dormousehole.readthedocs.io/en/latest/api.html#flask.Flask.route><code>route()</code></a> 装饰器来告诉 Flask 触发函数的 URL 。</li> <li>函数名称被用于生成相关联的 URL 。函数最后返回需要在用户浏览器中显示的信息。</li> </ol> <h2 id=_3>运行应用<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=c1># 导出 FLASK_APP 环境变量</span>
<span class=nb>export</span> <span class=nv>FLASK_APP</span><span class=o>=</span>hello.py <span class=c1># Linux系统 </span>
<span class=nb>set</span> <span class=nv>FLASK_APP</span><span class=o>=</span>hello.py <span class=c1># cmd</span>
<span class=nv>$env</span>:FLASK_APP <span class=o>=</span> <span class=s2>&quot;hello.py&quot;</span> <span class=c1># Power Shell</span>
</code></pre></div> <p><code>FLASK_APP</code> 环境变量中储存的是模块的名称，运行 <code>flask run</code> 命令就 会导入这个模块</p> <div class=highlight><pre><span></span><code><span class=c1># 运行应用（服务器仅本地可见）</span>
flask run <span class=c1># 或者 python -m flask run</span>
</code></pre></div> <div class=highlight><pre><span></span><code># 运行应用（可公开访问）
flask run --host=0.0.0.0  # 这行代码告诉你的操作系统监听所有公开的 IP
</code></pre></div> <h2 id=_4>调试模式<a class=headerlink href=#_4 title="Permanent link">&para;</a></h2> <p>（只需要记录出错信息和追踪堆栈？参见 <a href=https://dormousehole.readthedocs.io/en/latest/errorhandling.html#application-errors>应用错误处理</a> ）</p> <p>服务器会在修改应用代码之后自动重启，并且当应用出错时还会提供一个有用的调试器。</p> <div class=highlight><pre><span></span><code><span class=c1># 打开所有开发功能（包括调试模式）</span>
<span class=nb>export</span> <span class=nv>FLASK_ENV</span><span class=o>=</span>development <span class=c1># 在 Windows 下需要使用 set 来代替 export</span>
flask run
</code></pre></div> <p>这样可以实现以下功能：</p> <ol> <li>激活调试器。</li> <li>激活自动重载。</li> <li>打开 Flask 应用的调试模式。</li> </ol> <p>还可以通过导出 <code>FLASK_DEBUG=1</code> 来单独控制调试模式的开关。</p> <h2 id=_5>路由<a class=headerlink href=#_5 title="Permanent link">&para;</a></h2> <p>使用 <a href=https://dormousehole.readthedocs.io/en/latest/api.html#flask.Flask.route><code>route()</code></a> 装饰器把函数绑定到 URL:</p> <div class=highlight><pre><span></span><code><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>index</span><span class=p>():</span>
    <span class=k>return</span> <span class=s1>&#39;Index Page&#39;</span>

<span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/hello&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>hello</span><span class=p>():</span>
    <span class=k>return</span> <span class=s1>&#39;Hello, World&#39;</span>
</code></pre></div> <p>可以动态变化 URL 的某些部分， 还可以为一个函数指定多个规则。</p> <h3 id=_6>变量规则<a class=headerlink href=#_6 title="Permanent link">&para;</a></h3> <p>通过把 URL 的一部分标记为 <code>就可以在 URL 中添加变量。标记的 部分会作为关键字参数传递给函数。通过使用</code> ，可以 选择性的加上一个转换器，为变量指定规则。请看下面的例子:</p> <div class=highlight><pre><span></span><code><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/user/&lt;username&gt;&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>show_user_profile</span><span class=p>(</span><span class=n>username</span><span class=p>):</span>
    <span class=c1># show the user profile for that user</span>
    <span class=k>return</span> <span class=s1>&#39;User </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>escape</span><span class=p>(</span><span class=n>username</span><span class=p>)</span>

<span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/post/&lt;int:post_id&gt;&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>show_post</span><span class=p>(</span><span class=n>post_id</span><span class=p>):</span>
    <span class=c1># show the post with the given id, the id is an integer</span>
    <span class=k>return</span> <span class=s1>&#39;Post </span><span class=si>%d</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>post_id</span>

<span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/path/&lt;path:subpath&gt;&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>show_subpath</span><span class=p>(</span><span class=n>subpath</span><span class=p>):</span>
    <span class=c1># show the subpath after /path/</span>
    <span class=k>return</span> <span class=s1>&#39;Subpath </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>escape</span><span class=p>(</span><span class=n>subpath</span><span class=p>)</span>
</code></pre></div> <p>转换器类型：</p> <table> <thead> <tr> <th><code>string</code></th> <th>（缺省值） 接受任何不包含斜杠的文本</th> </tr> </thead> <tbody> <tr> <td><code>int</code></td> <td>接受正整数</td> </tr> <tr> <td><code>float</code></td> <td>接受正浮点数</td> </tr> <tr> <td><code>path</code></td> <td>类似 <code>string</code> ，但可以包含斜杠</td> </tr> <tr> <td><code>uuid</code></td> <td>接受 UUID 字符串</td> </tr> </tbody> </table> <h3 id=url>唯一的 URL / 重定向行为<a class=headerlink href=#url title="Permanent link">&para;</a></h3> <p>以下两条规则的不同之处在于是否使用尾部的斜杠。:</p> <div class=highlight><pre><span></span><code>@app.route(&#39;/projects/&#39;)
def projects():
    return &#39;The project page&#39;

@app.route(&#39;/about&#39;)
def about():
    return &#39;The about page&#39;
</code></pre></div> <p><code>projects</code> 的 URL 是中规中矩的，尾部有一个斜杠，看起来就如同一个文件夹。 访问一个没有斜杠结尾的 URL 时 Flask 会自动进行重定向，帮你在尾部加上一个斜杠。</p> <p><code>about</code> 的 URL 没有尾部斜杠，因此其行为表现与一个文件类似。如果访问这个 URL 时添加了尾部斜杠就会得到一个 404 错误。这样可以保持 URL 唯一，并帮助 搜索引擎避免重复索引同一页面。</p> <hr> <div class=md-source-date> <small> Last update: May 16, 2020 </small> </div> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/vendor.22b62ea4.min.js></script> <script src=../../../assets/javascripts/bundle.5f27aba8.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "../../..",
          features: ["instant", "tabs"],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.f6ebf1dc.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>
<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.1.7"><title>HTTP Cookies - Notes</title><link rel=stylesheet href=../../assets/stylesheets/main.4c7052ca.min.css><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style></head> <body dir=ltr> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#http-cookies class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=../.. title=Notes class="md-header-nav__button md-logo" aria-label=Notes> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Notes </span> <span class="md-header-nav__topic md-ellipsis"> HTTP Cookies </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class="md-tabs__link md-tabs__link--active"> Home </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=Notes class="md-nav__button md-logo" aria-label=Notes> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> Notes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Home class=md-nav__link> Home </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#cookie class=md-nav__link> 创建 Cookie </a> <nav class=md-nav aria-label="创建 Cookie"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#set-cookie-cookie class=md-nav__link> Set-Cookie响应头部 和 Cookie请求头部 </a> </li> <li class=md-nav__item> <a href=#cookie_1 class=md-nav__link> 会话期 Cookie </a> </li> <li class=md-nav__item> <a href=#cookie_2 class=md-nav__link> 持久性 Cookie </a> </li> <li class=md-nav__item> <a href=#secure class=md-nav__link> Secure 标记 </a> </li> <li class=md-nav__item> <a href=#httponly class=md-nav__link> HttpOnly 标记 </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 作用域 </a> </li> <li class=md-nav__item> <a href=#samesite-cookies class=md-nav__link> SameSite Cookies </a> </li> <li class=md-nav__item> <a href=#javascript-documentcookie-cookie class=md-nav__link> JavaScript 通过 Document.cookie 访问 Cookie </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=http-cookies>HTTP Cookies<a class=headerlink href=#http-cookies title="Permanent link">&para;</a></h1> <p>HTTP Cookie（也叫 Web Cookie 或浏览器 Cookie）是服务器发送到用户浏览器并保存在本地的一小块数据，它会在浏览器下次向同一服务器再发起请求时被携带并发送到服务器上。通常，它用于告知服务端两个请求是否来自同一浏览器，如保持用户的登录状态。Cookie 使基于<a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview#HTTP_is_stateless_but_not_sessionless>无状态</a>的 HTTP 协议记录稳定的状态信息成为了可能。</p> <p>Cookie 主要用于以下三个方面：</p> <ul> <li>会话状态管理（如用户登录状态、购物车、游戏分数或其它需要记录的信息）</li> <li>个性化设置（如用户自定义设置、主题等）</li> <li>浏览器行为跟踪（如跟踪分析用户行为等）</li> </ul> <p>Cookie 曾一度用于客户端数据的存储，因当时并没有其它合适的存储办法而作为唯一的存储手段，但现在随着现代浏览器开始支持各种各样的存储方式，Cookie 渐渐被淘汰。由于服务器指定 Cookie 后，浏览器的每次请求都会携带 Cookie 数据，会带来额外的性能开销（尤其是在移动环境下）。新的浏览器 API 已经允许开发者直接将数据存储到本地，如使用 <a href=https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Storage_API>Web storage API</a> （本地存储和会话存储）或 <a href=https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API>IndexedDB</a> 。</p> <h2 id=cookie>创建 Cookie<a class=headerlink href=#cookie title="Permanent link">&para;</a></h2> <p>当服务器收到 HTTP 请求时，服务器可以在响应头里面添加一个 <a href=https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Set-Cookie><code>Set-Cookie</code></a>选项。浏览器收到响应后通常会保存下 Cookie，之后对该服务器每一次请求中都通过 <a href=https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cookie><code>Cookie</code></a>请求头部将 Cookie 信息发送给服务器。另外，Cookie 的过期时间、域、路径、有效期、适用站点都可以根据需要来指定。</p> <h3 id=set-cookie-cookie><code>Set-Cookie响应头部</code> 和 <code>Cookie请求头部</code><a class=headerlink href=#set-cookie-cookie title="Permanent link">&para;</a></h3> <p>服务器使用 <a href=https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Set-Cookie><code>Set-Cookie</code></a>响应头部向用户代理（一般是浏览器）发送 Cookie 信息。一个简单的 Cookie 可能像这样：</p> <div class=highlight><pre><span></span><code>Set-Cookie: &lt;cookie名&gt;=&lt;cookie值&gt;
</code></pre></div> <p>服务器通过该头部告知客户端保存 Cookie 信息。</p> <p>Tips：如何在以下几种服务端程序中设i置 <code>Set-Cookie</code> 响应头信息 :</p> <ul> <li><a href=https://secure.php.net/manual/en/function.setcookie.php>PHP</a></li> <li><a href=https://nodejs.org/dist/latest-v8.x/docs/api/http.html#http_response_setheader_name_value>Node.JS</a></li> <li><a href=https://docs.python.org/3/library/http.cookies.html>Python</a></li> <li><a href=http://api.rubyonrails.org/classes/ActionDispatch/Cookies.html>Ruby on Rails</a></li> </ul> <div class=highlight><pre><span></span><code>HTTP/1.0 200 OK
Content-type: text/html
Set-Cookie: yummy_cookie=choco
Set-Cookie: tasty_cookie=strawberry

[页面内容]
</code></pre></div> <p>现在，对该服务器发起的每一次新请求，浏览器都会将之前保存的 Cookie 信息通过 <a href=https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cookie><code>Cookie</code></a> 请求头部再发送给服务器。</p> <div class=highlight><pre><span></span><code>GET /sample_page.html HTTP/1.1
Host: www.example.org
Cookie: yummy_cookie=choco; tasty_cookie=strawberry
</code></pre></div> <h3 id=cookie_1>会话期 Cookie<a class=headerlink href=#cookie_1 title="Permanent link">&para;</a></h3> <p>会话期 Cookie 是最简单的 Cookie：</p> <ul> <li> <p>浏览器关闭之后它会被自动删除，也就是说它仅在会话期内有效。</p> </li> <li> <p>不需要指定过期时间（<code>Expires</code>）或者有效期（Max-Age）。</p> </li> </ul> <p>有些浏览器提供了会话恢复功能，这种情况下即使关闭了浏览器，会话期 Cookie 也会被保留下来，就好像浏览器从来没有关闭一样。</p> <h3 id=cookie_2>持久性 Cookie<a class=headerlink href=#cookie_2 title="Permanent link">&para;</a></h3> <p>可以指定一个特定的过期时间（<code>Expires</code>）或有效期（<code>Max-Age</code>）。</p> <div class=highlight><pre><span></span><code>Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT;
</code></pre></div> <p>当 Cookie 的过期时间被设定时，设定的日期和时间只与客户端相关，而不是服务端。</p> <h3 id=secure><code>Secure</code> 标记<a class=headerlink href=#secure title="Permanent link">&para;</a></h3> <ul> <li>标记为 <code>Secure</code> 的 Cookie 只应通过被 HTTPS 协议加密过的请求发送给服务端。</li> <li>即便设置了 <code>Secure</code> 标记，敏感信息也不应该通过 Cookie 传输，因为 Cookie 有其固有的不安全性，<code>Secure</code>标记也无法提供确实的安全保障。</li> <li>从 Chrome 52 和 Firefox 52 开始，不安全的站点（<code>http:</code>）无法使用 Cookie 的 <code>Secure</code> 标记。</li> </ul> <h3 id=httponly><code>HttpOnly</code> 标记<a class=headerlink href=#httponly title="Permanent link">&para;</a></h3> <ul> <li> <p>为避免跨域脚本 (<a href=https://developer.mozilla.org/en-US/docs/Glossary/XSS>XSS</a>) 攻击，通过 JavaScript 的 <a href=https://developer.mozilla.org/zh-CN/docs/Web/API/Document/cookie><code>Document.cookie</code></a> API 无法访问带有 <code>HttpOnly</code> 标记的 Cookie，它们只应该发送给服务端。</p> </li> <li> <p>如果包含服务端 Session 信息的 Cookie 不想被客户端 JavaScript 脚本调用，那么就应该为其设置 <code>HttpOnly</code> 标记。</p> </li> </ul> <h3 id=_1>作用域<a class=headerlink href=#_1 title="Permanent link">&para;</a></h3> <p><code>Domain</code> 和 <code>Path</code> 标识定义了 Cookie 的*作用域：*即 Cookie 应该发送给哪些 URL。</p> <p><code>Domain</code> 标识指定了哪些主机可以接受 Cookie。如果不指定，默认为<a href=https://developer.mozilla.org/en-US/docs/Web/API/Document/location>当前文档的主机</a>（<strong>不包含子域名</strong>）。如果指定了 <code>Domain</code>，则一般包含子域名。</p> <p><code>Path</code> 标识指定了主机下的哪些路径可以接受 Cookie（该 URL 路径必须存在于请求 URL 中）。以字符 <code>%x2F</code> ("/") 作为路径分隔符，<strong>子路径也会被匹配。</strong></p> <h3 id=samesite-cookies><code>SameSite</code> Cookies<a class=headerlink href=#samesite-cookies title="Permanent link">&para;</a></h3> <p><code>SameSite</code> Cookie 允许服务器要求某个 cookie 在跨站请求时不会被发送，从而可以阻止跨站请求伪造攻击（<a href=https://developer.mozilla.org/en-US/docs/Glossary/CSRF>CSRF</a>）。</p> <div class=highlight><pre><span></span><code><span class=nx>Set</span><span class=o>-</span><span class=nx>Cookie</span><span class=o>:</span> <span class=nx>key</span><span class=o>=</span><span class=nx>value</span><span class=p>;</span> <span class=nx>SameSite</span><span class=o>=</span><span class=nx>Strict</span>
</code></pre></div> <p><code>SameSite</code> 参数的可选值：</p> <ul> <li> <p><code>None</code> ：浏览器会在同站请求、跨站请求下继续发送 cookies，不区分大小写。</p> </li> <li> <p><code>Strict</code> ：浏览器将只发送相同站点请求的 cookie (即当前网页 URL 与请求目标 URL 完全一致)。如果请求来自与当前 location 的 URL 不同的 URL，则不包括标记为 Strict 属性的 cookie。</p> </li> <li> <p><code>Lax</code> ：在新版本浏览器中，为默认选项，Same-site cookies 将会为一些跨站子请求保留，如图片加载或者 frames 的调用，但只有当用户从外部站点导航到 URL 时才会发送。如 link 链接。</p> </li> </ul> <h3 id=javascript-documentcookie-cookie>JavaScript 通过 Document.cookie 访问 Cookie<a class=headerlink href=#javascript-documentcookie-cookie title="Permanent link">&para;</a></h3> <p>通过 <a href=https://developer.mozilla.org/zh-CN/docs/Web/API/Document/cookie><code>Document.cookie</code></a>属性可创建新的 Cookie，也可通过该属性访问非 <code>HttpOnly</code> 标记的 Cookie。</p> <div class=highlight><pre><span></span><code><span class=nb>document</span><span class=p>.</span><span class=nx>cookie</span> <span class=o>=</span> <span class=s2>&quot;yummy_cookie=choco&quot;</span><span class=p>;</span> 
<span class=nb>document</span><span class=p>.</span><span class=nx>cookie</span> <span class=o>=</span> <span class=s2>&quot;tasty_cookie=strawberry&quot;</span><span class=p>;</span> 
<span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nb>document</span><span class=p>.</span><span class=nx>cookie</span><span class=p>);</span> 
<span class=c1>// logs &quot;yummy_cookie=choco; tasty_cookie=strawberry&quot;</span>
</code></pre></div> <p>JavaScript 可以通过跨站脚本攻击（XSS）的方式来窃取 Cookie。</p> <hr> <div class=md-source-date> <small> Last update: May 16, 2020 </small> </div> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/vendor.22b62ea4.min.js></script> <script src=../../assets/javascripts/bundle.5f27aba8.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "../..",
          features: ["instant", "tabs"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.f6ebf1dc.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>